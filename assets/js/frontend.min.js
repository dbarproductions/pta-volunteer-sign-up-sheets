window.ptaVolunteer={config:{ajaxUrl:"",method:"POST",extraData:{}},init(e={}){this.config={...this.config,...e},document.querySelector('input[name="signup_firstname"], input[name="signup_lastname"]')&&this.setupAutocomplete()},htmlDecode(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent},setupAutocomplete(){document.querySelectorAll('input[name="signup_firstname"], input[name="signup_lastname"], input[name="signup_email"]').forEach(e=>{e.addEventListener("input",async t=>{const n=await this.fetchResults(t.target.value);this.renderAutocomplete(n,e)})})},async fetchResults(e){const t=new FormData;t.append("q",e),t.append("pta_pub_action","autocomplete_volunteer"),t.append("action",this.config.extraData.action),t.append("security",this.config.extraData.security),console.log("Request URL:",this.config.ajaxUrl),console.log("Request Method:",this.config.method),console.log("Request Params:",Object.fromEntries(t));const n=await fetch(this.config.ajaxUrl,{method:"POST",body:t});return await n.json()},renderAutocomplete(e,t){console.log("Response data:",e);let n=document.querySelector(".autocomplete-results");n||(n=document.createElement("ul"),n.className="autocomplete-results",t.parentNode.appendChild(n)),e&&Array.isArray(e)?(n.innerHTML=e.map(e=>`\n            <li>\n                <a href="#" data-volunteer='${JSON.stringify(e)}'>\n                    <strong>${this.htmlDecode(e.firstname)} ${this.htmlDecode(e.lastname)}</strong>\n                    <br>\n                    <small>${this.htmlDecode(e.email)}</small>\n                </a>\n            </li>\n        `).join(""),n.addEventListener("click",e=>{if(e.preventDefault(),e.target.closest("a")){const t=JSON.parse(e.target.closest("a").dataset.volunteer);this.populateFields(t),n.remove()}})):n.innerHTML=""},populateFields(e){Object.keys(e).forEach(t=>{const n=document.querySelector(`input[name="signup_${t}"]`)||document.querySelector(`input[name="${t}"]`);n&&(n.value=this.htmlDecode(e[t]))});const t=document.querySelector('input[name="signup_validate_email"]');t&&(t.value=this.htmlDecode(e.email))}};