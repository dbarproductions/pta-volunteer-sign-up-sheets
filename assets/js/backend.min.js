!function(e){e(".tasks").sortable({distance:5,opacity:.6,cursor:"move",axis:"y"}),e("#multi999Picker").datepick({pickerClass:"pta",multiSelect:999,monthsToShow:2,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"}),e(".singlePicker").datepick({pickerClass:"pta",monthsToShow:1,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"}),e(".pta-timepicker").timepicker({showPeriod:!0,showLeadingZero:!0,defaultTime:""});let t=e("#loadingDiv").hide();function a(t){e("#task_description_"+t).toggle(),e(".pta_sus_task_description").not("#task_description_"+t).hide()}function i(t){e("#task_email_templates_"+t).toggle(),e(".pta_sus_task_email_templates").not("#task_email_templates_"+t).hide()}if(e(document).ajaxStart(function(){t.show()}).ajaxStop(function(){t.hide()}),e("#user_id").on("change",function(){let t=e(this).val();if(!t||"0"===t)return;let a={action:"pta_sus_get_user_data",security:PTASUS.ptaNonce,user_id:t};e.post(ajaxurl,a,function(t){t&&function(t){t&&"object"==typeof t&&(e.each(t,function(t,a){if("user_id"===t)return;if(["firstname","lastname","email","phone"].includes(t))return;let i=e('input[name="'+t+'"], select[name="'+t+'"], textarea[name="'+t+'"], select[name="'+t+'[]"]');if(i.length){const t=i[0].tagName.toLowerCase(),n=i[0].multiple||-1!==i[0].name.indexOf("[]");if("select"===t&&n){let e=[];Array.isArray(a)?e=a.map(e=>String(e).trim()).filter(e=>e):a&&(e=String(a).split(",").map(e=>e.trim()).filter(e=>e)),i.find("option").prop("selected",!1),e.forEach(function(e){i.find('option[value="'+e+'"]').prop("selected",!0)}),i.data("select2")?i.trigger("change"):setTimeout(function(){i.data("select2")&&i.trigger("change")},100)}else if("select"===t)i.val(a),i.data("select2")&&i.trigger("change");else if("textarea"===t)i.val(a);else if("input"===t&&"checkbox"===i.attr("type"))i.prop("checked",1==a||!0===a||"1"===a);else if("input"===t&&"radio"===i.attr("type"))e('input[type="radio"][name="'+i.attr("name")+'"][value="'+a+'"]').prop("checked",!0);else if("input"===t&&"true"===i.attr("data-quill-field")){const t=a||"";i.val(t);const n=i.attr("id")+"-quill-container",o=e("#"+n);if(o.length&&"undefined"!=typeof Quill){let e=o.data("quill-instance");if(e&&e.root)if(t){const a=e.clipboard.convert({html:t});e.setContents(a,"silent")}else e.setText("");else{i.attr("id");var s=t;if(e=new Quill("#"+n,{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link"]]}}),s){const t=e.clipboard.convert({html:s});e.setContents(t,"silent")}o.data("quill-instance",e),e.on("text-change",function(){var t=e.root.innerHTML;i.val()!==t&&i.val(t)})}}}else i.val(a)}}),e.each(t,function(t,a){if(!["firstname","lastname","email","phone"].includes(t))return;let i=e('input[name="'+t+'"]');i.length&&i.val(a)}))}(t)})}),function(){function e(){if(!document.querySelector("#firstname"))return;if("undefined"==typeof ptaVolunteer)return void console.warn("ptaVolunteer not available for admin live search");let e="";e="undefined"!=typeof ptaSUS&&ptaSUS.ajaxurl?ptaSUS.ajaxurl:"undefined"!=typeof ajaxurl?ajaxurl:admin_url("admin-ajax.php");let t="";if("undefined"!=typeof ptaSUS&&ptaSUS.ptaNonce)t=ptaSUS.ptaNonce;else if("undefined"!=typeof ptaSUS&&ptaSUS.ptanonce)t=ptaSUS.ptanonce;else{if("undefined"==typeof PTASUS||!PTASUS.ptaNonce)return void console.warn("Nonce not found for admin live search");t=PTASUS.ptaNonce}ptaVolunteer.init({ajaxUrl:e,extraData:{action:"pta_sus_live_search",security:t},fieldPrefix:"",updateUserDropdown:!0})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):setTimeout(function(){"undefined"!=typeof ptaVolunteer?e():setTimeout(e,200)},100)}(),e("input.details_checkbox","li").each(function(){e(this).is(":checked")&&e(this).closest("li").find(".pta_toggle").show()}),e(".task_description_trigger").on("click",function(t){t.preventDefault(),a(e(this).attr("id").split("_").pop())}),e(".task_email_templates_trigger").on("click",function(t){t.preventDefault(),i(e(this).attr("id").split("_").pop())}),e(".details_checkbox").change(function(){e(this).closest("li").find(".pta_toggle").toggle(this.checked)}),e(".tasks LI").length){const t=()=>{let t=0;return e(".tasks LI").each(function(){const a=e(this).attr("id");if(a){const e=parseInt(a.split("-")[1]);!isNaN(e)&&e>t&&(t=e)}}),t+1},s=(e,t)=>{const a=e.attr("id")?.replace(/\d+/,t),i=e.attr("name")?.replace(/\d+/,t);e.attr({id:a,name:i}),(e.is('input[type="text"]')||e.is('input[type="number"]'))&&e.val(""),e.hasClass("pta-timepicker")&&e.val("").removeClass("hasTimepicker"),e.is("textarea")&&(e.val(""),e.closest(".pta_sus_task_description").attr("id",`task_description_${t}`)),e.is("select")&&(e.prop("selectedIndex",0),e.attr("name")&&e.attr("name").includes("email_template_id")&&e.closest(".pta_sus_task_email_templates").attr("id",`task_email_templates_${t}`)),e.hasClass("details_text")&&e.val(PTASUS.default_text).closest("span").hide(),e.is(":checkbox")&&e.prop("checked",!1).val("YES"),e.hasClass("details_required")&&e.prop("checked",!0).closest("span").hide(),e.is('input[type="hidden"][name^="task_id"]')&&e.val("")},n=e=>{e.find(".pta-timepicker").removeClass("hasTimepicker").timepicker({showPeriod:!0,showLeadingZero:!0,defaultTime:""}),e.find(".singlePicker").removeClass("is-datepick").datepick({monthsToShow:1,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"})},o=(t,s)=>{t.find(".details_checkbox").on("change",function(){e(this).closest("li").find(".pta_toggle").toggle(this.checked)}),t.find("a.task_description_trigger").each(function(){const t=e(this).attr("id").replace(/\d+/,s);e(this).attr("id",t).on("click",function(t){t.preventDefault();a(e(this).attr("id").split("_").pop())})}),t.find("a.task_email_templates_trigger").each(function(){const t=e(this).attr("id").replace(/\d+/,s);e(this).attr("id",t).on("click",function(t){t.preventDefault();i(e(this).attr("id").split("_").pop())})})};e(document).on("click",".add-task-after",function(a){a.preventDefault(),e(".pta_sus_task_description").hide(),e(".pta_sus_task_email_templates").hide();const i=t(),l=e(".tasks LI").last().clone();l.attr("id",`task-${i}`),l.find("input, select, textarea").each(function(){s(e(this),i)}),e(this).parent("LI").after(l),n(l),o(l,i)}),e(document).on("click",".remove-task",function(t){t.preventDefault();1===e(".tasks LI").length&&e(this).prev().trigger("click"),e(this).parent("LI").remove()})}var s=e("span#sheet_title");if(s.length)var n=s.text();var o=e("span#sheet-info"),l="";if(o.length){var r=o.html();l=r.replace(/<br\s*[\/]?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," ")}function c(t,a,i){var s=t.replace(/<br\s*\/?>/gi,"\n").replace(/&nbsp;/g," "),n=e("<div>"+s+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}let p={layout:{topStart:["buttons","pageLength"],topEnd:"search",bottomStart:"info",bottomEnd:"paging"},order:[],colReorder:!0,responsive:!1,stateSave:!1,pageLength:100,lengthMenu:[[10,25,50,100,150,-1],[10,25,50,100,150,"All"]],columnDefs:[{orderSequence:["asc","desc"],targets:"_all"}],buttons:[{extend:"excel",text:PTASUS.excelExport,title:n,message:l,exportOptions:{columns:":visible",format:{body:c}}},{extend:"csv",text:PTASUS.csvExport,title:n,message:l,exportOptions:{columns:":visible",format:{body:c}}},{extend:"pdf",text:PTASUS.pdfSave,title:n,message:l,orientation:"landscape",exportOptions:{columns:":visible",format:{body:c}}},{extend:"print",text:PTASUS.toPrint,title:n,message:r,exportOptions:{columns:":visible",format:{body:c}},customize:function(t){e(t.document.body).find("table").addClass("display").css("font-size","11px")}},{extend:"colvis",text:PTASUS.colvisText},{text:PTASUS.hideRemaining,action:function(e,t,a,i){m.rows(".remaining").remove().draw(!1),this.disable()}},"createState","savedStates"]},d={layout:{topStart:["buttons","pageLength"],topEnd:"search",bottomStart:"info",bottomEnd:"paging"},order:[],colReorder:!0,responsive:!1,stateSave:!1,pageLength:100,lengthMenu:[[10,25,50,100,150,-1],[10,25,50,100,150,"All"]],columnDefs:[{orderSequence:["asc","desc"],targets:"_all"}],buttons:[{extend:"excel",text:PTASUS.excelExport,title:n,message:l,exportOptions:{columns:":visible",format:{body:c}}},{extend:"csv",text:PTASUS.csvExport,title:n,message:l,exportOptions:{columns:":visible",format:{body:c}}},{extend:"pdf",text:PTASUS.pdfSave,title:n,message:l,orientation:"landscape",exportOptions:{columns:":visible",format:{body:c}}},{extend:"print",text:PTASUS.toPrint,title:n,message:r,exportOptions:{columns:":visible",format:{body:c}},customize:function(t){e(t.document.body).find("table").addClass("display").css("font-size","11px")}},{extend:"colvis",text:PTASUS.colvisText},{text:PTASUS.hideRemaining,action:function(e,t,a,i){h.rows(".remaining").remove().draw(!1),this.disable()}},"createState","savedStates"]};function u(t){t.draw(),e(".pta-select-filter").remove(),t.columns(".select-filter").every(function(){var t=this,a=e('<select class="pta-select-filter" />').appendTo(this.footer()).on("change",function(){var a=e.fn.dataTable.util.escapeRegex(e(this).val());t.search(a?"^"+a+"$":"",!0,!1).draw()});a.append(e('<option value="">'+PTASUS.showAll+"</option>")),this.cache("search").sort().unique().each(function(t){""!==t&&a.append(e('<option value="'+t+'">'+t+"</option>"))})})}PTASUS.disableAdminGrouping||(p.rowGroup={dataSrc:[0,1],startRender:function(e,t,a){return t}},p.columnDefs.push({targets:[0,1],visible:!1}),p.buttons.push({text:PTASUS.disableGrouping,action:function(e,t,a,i){m.rowGroup().disable().draw(),this.disable()}}),d.rowGroup={dataSrc:[0,1,2],startRender:function(e,t,a){return t}},d.columnDefs.push({targets:[0,1,2],visible:!1}),d.buttons.push({text:PTASUS.disableGrouping,action:function(e,t,a,i){h.rowGroup().disable().draw(),this.disable()}}));var m=e("#pta-sheet-signups").DataTable(p);m.on("column-reorder",function(e,t,a){u(m)}),u(m);var h=e("#pta-all-data").DataTable(d);h.on("column-reorder",function(e,t,a){u(h)}),u(h),e('#pta-reschedule-sheet-form [name="method"]').on("change",function(t){"multi-copy"===e(this).val()?(e(".pta-hide-if-multi").hide(),e(".pta-show-if-multi").show(),e(".singlePicker").prop("required",!1),e(".pta-multi-input").prop("required",!0)):(e(".pta-hide-if-multi").show(),e(".pta-show-if-multi").hide(),e(".singlePicker").prop("required",!0),e(".pta-multi-input").prop("required",!1))}).trigger("change");let f=e("#pta_sheet_id"),g=e("p.task_select"),v=e("#pta_task_id"),_=e("p.move-signup"),x=e("#pta-move-signup-submit"),b=e("p.admin_confirm"),k=e("#pta_admin_confirm"),S=e("#signup_qty").val();function y(t){const a=e('<div class="notice notice-success" style="position: fixed; top: 32px; left: 50%; transform: translateX(-50%); z-index: 9999; min-width: 300px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);"><p>'+t+'<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></p></div>');e("body").append(a),a.find(".notice-dismiss").on("click",function(){a.fadeOut(()=>a.remove())}),setTimeout(()=>{a.fadeOut(()=>a.remove())},2e3)}v.on("change",function(){b.hide().prop("checked",!1);let t=e("#pta-ajax-messages");t.length&&t.remove(),""!==e(this).val()&&b.show().prop("checked",!1)}),f.on("change",function(){g.hide(),v.empty(),_.hide(),b.hide().prop("checked",!1);let t=e(this).val(),a={action:"pta_sus_get_tasks_for_sheet",security:PTASUS.ptaNonce,sheet_id:t,old_task_id:e("#old_task_id").val(),old_signup_id:e("#old_signup_id").val(),qty:S};e.post(ajaxurl,a,function(a){if(a&&(!1===a.success&&""!==t&&(e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>'+a.message+"</p></div>"),e(".pta-message-close").on("click",function(t){t.preventDefault(),e("#pta-message").fadeOut("fast",function(){e("#pta-message").remove()})})),!0===a.success)){let t=a.tasks;console.log(Object.keys(t).length),e(t).length?(Object.keys(t).length>1?v.append(e("<option></option>").attr("value","").text("Please Select a Task")):_.show(),Object.keys(t).length>0?(g.show(),e.each(t,function(t,a){v.append(e("<option></option>").attr("value",t).text(a))}),1===Object.keys(t).length&&v.trigger("change")):e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>No Available Tasks for that event.</p></div>')):e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>No Available Tasks for that event.</p></div>')}})}).trigger("change"),k.on("click change",function(){e(this).is(":checked")?(_.show(),x.prop("disabled",!1)):(_.hide(),x.prop("disabled",!0))}),e("#pta-sus-template-helper-toggle").on("click",function(){e("#pta-sus-template-helper-panel").toggleClass("active")}),e(".tag-item").on("click",function(){const t=e(this).data("tag");if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(t).then(()=>{y("Template tag copied to clipboard!")});else{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),y("Template tag copied to clipboard!")}}),e(".pta-sus-helper-search input").on("input",function(){const t=e(this).val().toLowerCase();e(".tag-item").each(function(){const a=e(this).text().toLowerCase();e(this).toggle(a.includes(t))})}),e(document).on("keyup",function(t){"Escape"===t.key&&e("#pta-sus-template-helper-panel").removeClass("active")}),e(".pta-sus-helper-search").append('<button type="button" class="pta-helper-close" aria-label="Close template helper"><span class="dashicons dashicons-no-alt"></span></button>'),e(".pta-helper-close").on("click",function(){e("#pta-sus-template-helper-panel").removeClass("active")})}(jQuery);