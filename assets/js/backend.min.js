!function(e){e(".tasks").sortable({distance:5,opacity:.6,cursor:"move",axis:"y"}),e("#multi999Picker").datepick({pickerClass:"pta",multiSelect:999,monthsToShow:2,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"}),e(".singlePicker").datepick({pickerClass:"pta",monthsToShow:1,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"}),e(".pta-timepicker").timepicker({showPeriod:!0,showLeadingZero:!0,defaultTime:""});let t=e("#loadingDiv").hide();function a(t){e("#task_description_"+t).toggle(),e(".pta_sus_task_description").not("#task_description_"+t).hide()}function i(t){e("#task_email_templates_"+t).toggle(),e(".pta_sus_task_email_templates").not("#task_email_templates_"+t).hide()}if(e(document).ajaxStart(function(){t.show()}).ajaxStop(function(){t.hide()}),e("#user_id").on("change",function(){let t=e(this).val();if(!t||"0"===t)return;let a={action:"pta_sus_get_user_data",security:PTASUS.ptaNonce,user_id:t};e.post(ajaxurl,a,function(t){t&&function(t){t&&"object"==typeof t&&(e.each(t,function(t,a){if("user_id"===t)return;if(["firstname","lastname","email","phone"].includes(t))return;let i=e('input[name="'+t+'"], select[name="'+t+'"], textarea[name="'+t+'"], select[name="'+t+'[]"]');if(i.length){const t=i[0].tagName.toLowerCase(),s=i[0].multiple||-1!==i[0].name.indexOf("[]");if("select"===t&&s){let e=[];Array.isArray(a)?e=a.map(e=>String(e).trim()).filter(e=>e):a&&(e=String(a).split(",").map(e=>e.trim()).filter(e=>e)),i.find("option").prop("selected",!1),e.forEach(function(e){i.find('option[value="'+e+'"]').prop("selected",!0)}),i.data("select2")?i.trigger("change"):setTimeout(function(){i.data("select2")&&i.trigger("change")},100)}else if("select"===t)i.val(a),i.data("select2")&&i.trigger("change");else if("textarea"===t)i.val(a);else if("input"===t&&"checkbox"===i.attr("type"))i.prop("checked",1==a||!0===a||"1"===a);else if("input"===t&&"radio"===i.attr("type"))e('input[type="radio"][name="'+i.attr("name")+'"][value="'+a+'"]').prop("checked",!0);else if("input"===t&&"true"===i.attr("data-quill-field")){const t=a||"";i.val(t);const s=i.attr("id")+"-quill-container",o=e("#"+s);if(o.length&&"undefined"!=typeof Quill){let e=o.data("quill-instance");if(e&&e.root)if(t){const a=e.clipboard.convert({html:t});e.setContents(a,"silent")}else e.setText("");else{i.attr("id");var n=t;if(e=new Quill("#"+s,{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link"]]}}),n){const t=e.clipboard.convert({html:n});e.setContents(t,"silent")}o.data("quill-instance",e),e.on("text-change",function(){var t=e.root.innerHTML;i.val()!==t&&i.val(t)})}}}else i.val(a)}}),e.each(t,function(t,a){if(!["firstname","lastname","email","phone"].includes(t))return;let i=e('input[name="'+t+'"]');i.length&&i.val(a)}))}(t)})}),function(){function e(){if(!document.querySelector("#firstname"))return;if("undefined"==typeof ptaVolunteer)return void console.warn("ptaVolunteer not available for admin live search");let e="";e="undefined"!=typeof ptaSUS&&ptaSUS.ajaxurl?ptaSUS.ajaxurl:"undefined"!=typeof ajaxurl?ajaxurl:admin_url("admin-ajax.php");let t="";if("undefined"!=typeof ptaSUS&&ptaSUS.ptaNonce)t=ptaSUS.ptaNonce;else if("undefined"!=typeof ptaSUS&&ptaSUS.ptanonce)t=ptaSUS.ptanonce;else{if("undefined"==typeof PTASUS||!PTASUS.ptaNonce)return void console.warn("Nonce not found for admin live search");t=PTASUS.ptaNonce}ptaVolunteer.init({ajaxUrl:e,extraData:{action:"pta_sus_live_search",security:t},fieldPrefix:"",updateUserDropdown:!0})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):setTimeout(function(){"undefined"!=typeof ptaVolunteer?e():setTimeout(e,200)},100)}(),e("input.details_checkbox","li").each(function(){e(this).is(":checked")&&e(this).closest("li").find(".pta_toggle").show()}),e(".task_description_trigger").on("click",function(t){t.preventDefault(),a(e(this).attr("id").split("_").pop())}),e(".task_email_templates_trigger").on("click",function(t){t.preventDefault(),i(e(this).attr("id").split("_").pop())}),e(".details_checkbox").change(function(){e(this).closest("li").find(".pta_toggle").toggle(this.checked)}),e(".tasks LI").length){const z=()=>{let t=0;return e(".tasks LI").each(function(){const a=e(this).attr("id");if(a){const e=parseInt(a.split("-")[1]);!isNaN(e)&&e>t&&(t=e)}}),t+1},X=(e,t)=>{const a=e.attr("id")?.replace(/\d+/,t),i=e.attr("name")?.replace(/\d+/,t);e.attr({id:a,name:i}),(e.is('input[type="text"]')||e.is('input[type="number"]'))&&e.val(""),e.hasClass("pta-timepicker")&&e.val("").removeClass("hasTimepicker"),e.is("textarea")&&(e.val(""),e.closest(".pta_sus_task_description").attr("id",`task_description_${t}`)),e.is("select")&&(e.prop("selectedIndex",0),e.attr("name")&&e.attr("name").includes("email_template_id")&&e.closest(".pta_sus_task_email_templates").attr("id",`task_email_templates_${t}`)),e.hasClass("details_text")&&e.val(PTASUS.default_text).closest("span").hide(),e.is(":checkbox")&&e.prop("checked",!1).val("YES"),e.hasClass("details_required")&&e.prop("checked",!0).closest("span").hide(),e.is('input[type="hidden"][name^="task_id"]')&&e.val("")},V=e=>{e.find(".pta-timepicker").removeClass("hasTimepicker").timepicker({showPeriod:!0,showLeadingZero:!0,defaultTime:""}),e.find(".singlePicker").removeClass("is-datepick").datepick({monthsToShow:1,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"})},$=(t,n)=>{t.find(".details_checkbox").on("change",function(){e(this).closest("li").find(".pta_toggle").toggle(this.checked)}),t.find("a.task_description_trigger").each(function(){const t=e(this).attr("id").replace(/\d+/,n);e(this).attr("id",t).on("click",function(t){t.preventDefault();a(e(this).attr("id").split("_").pop())})}),t.find("a.task_email_templates_trigger").each(function(){const t=e(this).attr("id").replace(/\d+/,n);e(this).attr("id",t).on("click",function(t){t.preventDefault();i(e(this).attr("id").split("_").pop())})})};e(document).on("click",".add-task-after",function(t){t.preventDefault(),e(".pta_sus_task_description").hide(),e(".pta_sus_task_email_templates").hide();const a=z(),i=e(".tasks LI").last().clone();i.attr("id",`task-${a}`),i.find("input, select, textarea").each(function(){X(e(this),a)}),e(this).parent("LI").after(i),V(i),$(i,a)}),e(document).on("click",".remove-task",function(t){t.preventDefault();1===e(".tasks LI").length&&e(this).prev().trigger("click"),e(this).parent("LI").remove()})}var n=e("span#sheet_title");if(n.length)var s=n.text();var o=e("span#sheet-info"),r="";if(o.length){var l=o.html();r=l.replace(/<br\s*[\/]?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," ")}function c(t,a,i){var n=t.replace(/<br\s*\/?>/gi,"\n").replace(/&nbsp;/g," "),s=e("<div>"+n+"</div>");return s.find("a").replaceWith(function(){return this.childNodes}),s.text()}var p=!1,d=!1,u={},f={},h=[],m=[],g=[],S="",v="",_=PTASUS.rfShowExpired?1:0,x=PTASUS.rfShowEmpty?1:0;let b={layout:{topStart:["buttons","pageLength"],topEnd:"search",bottomStart:"info",bottomEnd:"paging"},order:[],colReorder:!0,responsive:!1,stateSave:!1,pageLength:100,lengthMenu:[[10,25,50,100,150,-1],[10,25,50,100,150,"All"]],columnDefs:[{orderSequence:["asc","desc"],targets:"_all"}],buttons:[{extend:"excel",text:PTASUS.excelExport,title:s,message:r,exportOptions:{columns:":visible",format:{body:c}}},{extend:"csv",text:PTASUS.csvExport,title:s,message:r,exportOptions:{columns:":visible",format:{body:c}}},{extend:"pdf",text:PTASUS.pdfSave,title:s,message:r,orientation:"landscape",exportOptions:{columns:":visible",format:{body:c}}},{extend:"print",text:PTASUS.toPrint,title:s,message:l,exportOptions:{columns:":visible",format:{body:c}},customize:function(t){e(t.document.body).find("table").addClass("display").css("font-size","11px")}},{extend:"colvis",text:PTASUS.colvisText},{text:PTASUS.hideRemaining,action:function(e,t,a,i){PTASUS.serverSide?(p=!0,t.ajax.reload()):U.rows(".remaining").remove().draw(!1),this.disable()}},"createState","savedStates"]},k={layout:{topStart:["buttons","pageLength"],topEnd:"search",bottomStart:"info",bottomEnd:"paging"},order:[],colReorder:!0,responsive:!1,stateSave:!1,pageLength:100,lengthMenu:[[10,25,50,100,150,-1],[10,25,50,100,150,"All"]],columnDefs:[{orderSequence:["asc","desc"],targets:"_all"}],buttons:[{extend:"excel",text:PTASUS.excelExport,title:s,message:r,exportOptions:{columns:":visible",format:{body:c}}},{extend:"csv",text:PTASUS.csvExport,title:s,message:r,exportOptions:{columns:":visible",format:{body:c}}},{extend:"pdf",text:PTASUS.pdfSave,title:s,message:r,orientation:"landscape",exportOptions:{columns:":visible",format:{body:c}}},{extend:"print",text:PTASUS.toPrint,title:s,message:l,exportOptions:{columns:":visible",format:{body:c}},customize:function(t){e(t.document.body).find("table").addClass("display").css("font-size","11px")}},{extend:"colvis",text:PTASUS.colvisText},{text:PTASUS.hideRemaining,action:function(e,t,a,i){PTASUS.serverSide?(d=!0,t.ajax.reload()):j.rows(".remaining").remove().draw(!1),this.disable()}},"createState","savedStates"]};function y(t){t.draw(),e(".pta-select-filter").remove(),t.columns(".select-filter").every(function(){var t=this,a=e('<select class="pta-select-filter" />').appendTo(this.footer()).on("change",function(){var a=e.fn.dataTable.util.escapeRegex(e(this).val());t.search(a?"^"+a+"$":"",!0,!1).draw()});a.append(e('<option value="">'+PTASUS.showAll+"</option>")),this.cache("search").sort().unique().each(function(t){""!==t&&a.append(e('<option value="'+t+'">'+t+"</option>"))})})}function T(t,a){t.columns(".select-filter").every(function(){var t=this,i=this.index(),n=e(this.footer()),s=n.find("select.pta-select-filter").val()||"";n.find("select.pta-select-filter").remove();var o=e('<select class="pta-select-filter" />').appendTo(n).on("change",function(){t.search(e(this).val()).draw()});o.append('<option value="">'+PTASUS.showAll+"</option>"),(a[i]||[]).slice().sort().forEach(function(t){""!==t&&o.append(e("<option>").val(t).text(t))}),s&&o.val(s)})}if(PTASUS.disableAdminGrouping||(b.rowGroup={dataSrc:[0,1],startRender:function(e,t,a){return t}},b.columnDefs.push({targets:[0,1],visible:!1}),b.buttons.push({text:PTASUS.disableGrouping,action:function(e,t,a,i){U.rowGroup().disable().draw(),this.disable()}}),k.rowGroup={dataSrc:[0,1,2],startRender:function(e,t,a){return t}},k.columnDefs.push({targets:[0,1,2],visible:!1}),k.buttons.push({text:PTASUS.disableGrouping,action:function(e,t,a,i){j.rowGroup().disable().draw(),this.disable()}})),PTASUS.serverSide){b.colReorder=!1,k.colReorder=!1;var w=(e("#pta-sheet-signups").data("column-slugs")||"").toString().split(",").filter(Boolean),A=(e("#pta-all-data").data("column-slugs")||"").toString().split(",").filter(Boolean);function P(t,a,i,n){var s=["excel","csv","pdf","print"];t.buttons=t.buttons.map(function(t){if("object"!=typeof t||!t.extend)return t;if(-1===s.indexOf(t.extend))return t;var o=t.extend;return{text:t.text,action:function(t,s){var r=function(e,t,a,i){var n={action:"PTA_SUS_ADMIN_EXPORT",ptaNonce:PTASUS.ptaNonce,view_type:t,hide_remaining:i()?1:0,column_slugs:a.join(","),search:e.search(),order_col:e.order()[0]?e.order()[0][0]:0,order_dir:e.order()[0]?e.order()[0][1]:"asc"},s={};return e.columns(".select-filter").every(function(e){var t=this.search();t&&(s[e]=t)}),n.col_search=JSON.stringify(s),"single_sheet"===t?n.sheet_id=PTASUS.sheetId||0:(g.length&&(n.sheet_ids=g),n.start_date=S,n.end_date=v,n.show_expired=_,n.show_empty=x),n}(s,a,i,n);!function(t,a){var i="print"===t||"pdf"===t,n=document.createElement("form");n.method="POST",n.action=ajaxurl,n.target=i?"_blank":"_self",a.format=t,e.each(a,function(t,a){if(e.isArray(a))e.each(a,function(e,a){var i=document.createElement("input");i.type="hidden",i.name=t+"[]",i.value=a,n.appendChild(i)});else{var i=document.createElement("input");i.type="hidden",i.name=t,i.value=null==a?"":a,n.appendChild(i)}}),document.body.appendChild(n),n.submit(),document.body.removeChild(n)}(o,r)}}})}b.serverSide=!0,b.ajax={url:ajaxurl,type:"POST",data:function(e){e.action="PTA_SUS_ADMIN_DT_DATA",e.ptaNonce=PTASUS.ptaNonce,e.view_type="single_sheet",e.sheet_id=PTASUS.sheetId||0,e.hide_remaining=p?1:0,e.column_slugs=w.join(",")}},b.createdRow=function(t,a,i){h[i]&&e(t).addClass(h[i])},k.serverSide=!0,k.ajax={url:ajaxurl,type:"POST",data:function(e){e.action="PTA_SUS_ADMIN_DT_DATA",e.ptaNonce=PTASUS.ptaNonce,e.view_type="all_data",e.hide_remaining=d?1:0,e.column_slugs=A.join(","),g.length&&(e.sheet_ids=g),e.start_date=S,e.end_date=v,e.show_expired=_,e.show_empty=x}},k.createdRow=function(t,a,i){m[i]&&e(t).addClass(m[i])},P(b,"single_sheet",w,function(){return p}),P(k,"all_data",A,function(){return d}),k.buttons=k.buttons.filter(function(e){return"object"!=typeof e||e.text!==PTASUS.hideRemaining}),b.buttons=b.buttons.map(function(t){return"object"!=typeof t||t.text!==PTASUS.hideRemaining?t:{text:PTASUS.hideRemaining,action:function(t,a,i){p=!p,e(i).text(p?PTASUS.showRemaining:PTASUS.hideRemaining),a.ajax.reload()}}})}var U=e("#pta-sheet-signups").DataTable(b);U.on("column-reorder",function(e,t,a){PTASUS.serverSide?T(U,u):y(U)}),PTASUS.serverSide?U.on("xhr.dt",function(e,t,a){a&&(a.rowClasses&&(h=a.rowClasses),a.filterOptions&&(u=a.filterOptions,T(U,a.filterOptions)))}):y(U);var j=e("#pta-all-data").DataTable(k);if(j.on("column-reorder",function(e,t,a){PTASUS.serverSide?T(j,f):y(j)}),PTASUS.serverSide?j.on("xhr.dt",function(e,t,a){a&&(a.rowClasses&&(m=a.rowClasses),a.filterOptions&&(f=a.filterOptions,T(j,a.filterOptions)))}):y(j),e("#pta-report-filters-wrap").length)if(e("#pta-rf-toggle").on("click",function(){var t=e(this).find(".dashicons");e("#pta-rf-body").slideToggle(150,function(){t.toggleClass("dashicons-arrow-down-alt2 dashicons-arrow-up-alt2")})}),e.fn&&e.fn.select2&&e("#pta-rf-sheet-ids").select2({placeholder:PTASUS.rfAllSheets||"All Sheets",allowClear:!0,width:"element"}),PTASUS.serverSide){var C=e("#pta-rf-apply"),O=C.text();j.on("processing.dt",function(e,t,a){C.prop("disabled",a).toggleClass("pta-rf-loading",a).text(a?O+"â€¦":O)}),e("#pta-rf-form").on("submit",function(t){t.preventDefault();var a=e("#pta-rf-sheet-ids").val()||[];g=a.map(Number).filter(Boolean),S=e("#pta-rf-start-date").val()||"",v=e("#pta-rf-end-date").val()||"",_=e("#pta-rf-show-expired").is(":checked")?1:0,x=e("#pta-rf-show-empty").is(":checked")?1:0,j.ajax.reload()}),e("#pta-rf-reset").on("click",function(){e.fn&&e.fn.select2?e("#pta-rf-sheet-ids").val(null).trigger("change"):e("#pta-rf-sheet-ids option").prop("selected",!1),e("#pta-rf-start-date, #pta-rf-end-date").val(""),e("#pta-rf-show-expired").prop("checked",!!PTASUS.rfShowExpired),e("#pta-rf-show-empty").prop("checked",!!PTASUS.rfShowEmpty),g=[],S="",v="",_=PTASUS.rfShowExpired?1:0,x=PTASUS.rfShowEmpty?1:0,j.ajax.reload()})}else e("#pta-rf-reset").on("click",function(){window.location.href=e(this).data("reset-url")});e('#pta-reschedule-sheet-form [name="method"]').on("change",function(t){"multi-copy"===e(this).val()?(e(".pta-hide-if-multi").hide(),e(".pta-show-if-multi").show(),e(".singlePicker").prop("required",!1),e(".pta-multi-input").prop("required",!0)):(e(".pta-hide-if-multi").show(),e(".pta-show-if-multi").hide(),e(".singlePicker").prop("required",!0),e(".pta-multi-input").prop("required",!1))}).trigger("change");let D=e("#pta_sheet_id"),E=e("p.task_select"),N=e("#pta_task_id"),L=e("p.move-signup"),R=e("#pta-move-signup-submit"),q=e("p.admin_confirm"),I=e("#pta_admin_confirm"),G=e("#signup_qty").val();function M(t){const a=e('<div class="notice notice-success" style="position: fixed; top: 32px; left: 50%; transform: translateX(-50%); z-index: 9999; min-width: 300px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);"><p>'+t+'<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></p></div>');e("body").append(a),a.find(".notice-dismiss").on("click",function(){a.fadeOut(()=>a.remove())}),setTimeout(()=>{a.fadeOut(()=>a.remove())},2e3)}N.on("change",function(){q.hide().prop("checked",!1);let t=e("#pta-ajax-messages");t.length&&t.remove(),""!==e(this).val()&&q.show().prop("checked",!1)}),D.on("change",function(){E.hide(),N.empty(),L.hide(),q.hide().prop("checked",!1);let t=e(this).val(),a={action:"pta_sus_get_tasks_for_sheet",security:PTASUS.ptaNonce,sheet_id:t,old_task_id:e("#old_task_id").val(),old_signup_id:e("#old_signup_id").val(),qty:G};e.post(ajaxurl,a,function(a){if(a&&(!1===a.success&&""!==t&&(e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>'+a.message+"</p></div>"),e(".pta-message-close").on("click",function(t){t.preventDefault(),e("#pta-message").fadeOut("fast",function(){e("#pta-message").remove()})})),!0===a.success)){let t=a.tasks;console.log(Object.keys(t).length),e(t).length?(Object.keys(t).length>1?N.append(e("<option></option>").attr("value","").text("Please Select a Task")):L.show(),Object.keys(t).length>0?(E.show(),e.each(t,function(t,a){N.append(e("<option></option>").attr("value",t).text(a))}),1===Object.keys(t).length&&N.trigger("change")):e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>No Available Tasks for that event.</p></div>')):e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>No Available Tasks for that event.</p></div>')}})}).trigger("change"),I.on("click change",function(){e(this).is(":checked")?(L.show(),R.prop("disabled",!1)):(L.hide(),R.prop("disabled",!0))}),e("#pta-sus-template-helper-toggle").on("click",function(){e("#pta-sus-template-helper-panel").toggleClass("active")}),e(".tag-item").on("click",function(){const t=e(this).data("tag");if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(t).then(()=>{M("Template tag copied to clipboard!")});else{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),M("Template tag copied to clipboard!")}}),e(".pta-sus-helper-search input").on("input",function(){const t=e(this).val().toLowerCase();e(".tag-item").each(function(){const a=e(this).text().toLowerCase();e(this).toggle(a.includes(t))})}),e(document).on("keyup",function(t){"Escape"===t.key&&e("#pta-sus-template-helper-panel").removeClass("active")}),e(".pta-sus-helper-search").append('<button type="button" class="pta-helper-close" aria-label="Close template helper"><span class="dashicons dashicons-no-alt"></span></button>'),e(".pta-helper-close").on("click",function(){e("#pta-sus-template-helper-panel").removeClass("active")})}(jQuery);