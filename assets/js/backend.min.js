!function(e){e(".tasks").sortable({distance:5,opacity:.6,cursor:"move",axis:"y"}),e("#multi999Picker").datepick({pickerClass:"pta",multiSelect:999,monthsToShow:2,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"}),e(".singlePicker").datepick({pickerClass:"pta",monthsToShow:1,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"}),e(".pta-timepicker").timepicker({showPeriod:!0,showLeadingZero:!0,defaultTime:""});let t=e("#loadingDiv").hide();e(document).ajaxStart(function(){t.show()}).ajaxStop(function(){t.hide()}),e("#user_id").on("change",function(){let t=e(this).val(),s={action:"pta_sus_get_user_data",security:PTASUS.ptaNonce,user_id:t};e.post(ajaxurl,s,function(t){t&&e.each(t,function(t,s){let a=e("input[name="+t+"]");a.length&&a.val(s)})})});let s=e("#firstname");function a(t){e("#task_description_"+t).toggle(),e(".pta_sus_task_description").not("#task_description_"+t).hide()}if(s.autocomplete({source:function(t,a){e.ajax({type:"POST",url:ajaxurl,data:{action:"pta_sus_user_search",keyword:s.val(),security:PTASUS.ptaNonce},success:function(e){a(e)},error:function(e){console.log(e)}})}}),s.on("autocompleteselect",function(t,s){let a=s.item.user_id;e("select[name=user_id] option[value="+a+"]").attr("selected","selected"),e.each(s.item,function(t,s){if("label"!==t&&"value"!==t&&"user_id"!==t){let a=e("input[name="+t+"]");a.length&&a.val(s)}})}),e("input.details_checkbox","li").each(function(){e(this).is(":checked")&&e(this).closest("li").find(".pta_toggle").show()}),e(".task_description_trigger").on("click",function(t){t.preventDefault(),a(e(this).attr("id").split("_").pop())}),e(".details_checkbox").change(function(){e(this).closest("li").find(".pta_toggle").toggle(this.checked)}),e(".tasks LI").length){const t=()=>{let t=0;return e(".tasks LI").each(function(){const s=e(this).attr("id");if(s){const e=parseInt(s.split("-")[1]);!isNaN(e)&&e>t&&(t=e)}}),t+1},s=(e,t)=>{const s=e.attr("id")?.replace(/\d+/,t),a=e.attr("name")?.replace(/\d+/,t);e.attr({id:s,name:a}),(e.is('input[type="text"]')||e.is('input[type="number"]'))&&e.val(""),e.hasClass("pta-timepicker")&&e.val("").removeClass("hasTimepicker"),e.is("textarea")&&(e.val(""),e.closest(".pta_sus_task_description").attr("id",`task_description_${t}`)),e.hasClass("details_text")&&e.val(PTASUS.default_text).closest("span").hide(),e.is(":checkbox")&&e.prop("checked",!1).val("YES"),e.hasClass("details_required")&&e.prop("checked",!0).closest("span").hide(),e.is('input[type="hidden"][name^="task_id"]')&&e.val("")},i=e=>{e.find(".pta-timepicker").removeClass("hasTimepicker").timepicker({showPeriod:!0,showLeadingZero:!0,defaultTime:""}),e.find(".singlePicker").removeClass("is-datepick").datepick({monthsToShow:1,dateFormat:"yyyy-mm-dd",showTrigger:"#calImg"})},n=(t,s)=>{t.find(".details_checkbox").on("change",function(){e(this).closest("li").find(".pta_toggle").toggle(this.checked)}),t.find("a.task_description_trigger").each(function(){const t=e(this).attr("id").replace(/\d+/,s);e(this).attr("id",t).on("click",function(t){t.preventDefault();a(e(this).attr("id").split("_").pop())})})};e(document).on("click",".add-task-after",function(a){a.preventDefault(),e(".pta_sus_task_description").hide();const o=t(),c=e(".tasks LI").last().clone();c.attr("id",`task-${o}`),c.find("input, select, textarea").each(function(){s(e(this),o)}),e(this).parent("LI").after(c),i(c),n(c,o)}),e(document).on("click",".remove-task",function(t){t.preventDefault();1===e(".tasks LI").length&&e(this).prev().trigger("click"),e(this).parent("LI").remove()})}var i=e("span#sheet_title");if(i.length)var n=i.text();var o=e("span#sheet-info"),c="";if(o.length){var r=o.html();c=r.replace(/<br\s*[\/]?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," ")}let l={order:[],dom:"<B>lfrtip",colReorder:!0,responsive:!1,stateSave:!1,pageLength:100,lengthMenu:[[10,25,50,100,150,-1],[10,25,50,100,150,"All"]],buttons:[{extend:"excel",text:PTASUS.excelExport,title:n,message:c,exportOptions:{columns:":visible",format:{body:function(t,s,a){t.match(/<span class="pta-sortdate">/)&&(t=t.substring(45));var i=t.replace(/<br\s*\/?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," "),n=e("<div>"+i+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}}}},{extend:"csv",text:PTASUS.csvExport,title:n,message:c,exportOptions:{columns:":visible",format:{body:function(t,s,a){t.match(/<span class="pta-sortdate">/)&&(t=t.substring(45));var i=t.replace(/<br\s*\/?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," "),n=e("<div>"+i+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}}}},{extend:"pdf",text:PTASUS.pdfSave,title:n,message:c,orientation:"landscape",exportOptions:{columns:":visible",format:{body:function(t,s,a){t.match(/<span class="pta-sortdate">/)&&(t=t.substring(45));var i=t.replace(/<br\s*\/?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," "),n=e("<div>"+i+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}}}},{extend:"print",text:PTASUS.toPrint,title:n,message:r,exportOptions:{columns:":visible",format:{body:function(t,s,a){t.match(/<span class="pta-sortdate">/)&&(t=t.substring(45));var i=t.replace(/<br\s*\/?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," "),n=e("<div>"+i+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}}},customize:function(t){e(t.document.body).find("table").addClass("display").css("font-size","11px")}},{extend:"colvis",text:PTASUS.colvisText},{text:PTASUS.hideRemaining,action:function(e,t,s,a){u.rows(".remaining").remove().draw(!1),this.disable()}},"createState","savedStates"]},p={order:[],dom:"<B>lfrtip",colReorder:!0,responsive:!1,stateSave:!1,pageLength:100,lengthMenu:[[10,25,50,100,150,-1],[10,25,50,100,150,"All"]],buttons:[{extend:"excel",text:PTASUS.excelExport,title:n,message:c,exportOptions:{columns:":visible",format:{body:function(t,s,a){t.match(/<span class="pta-sortdate">/)&&(t=t.substring(45));var i=t.replace(/<br\s*\/?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," "),n=e("<div>"+i+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}}}},{extend:"csv",text:PTASUS.csvExport,title:n,message:c,exportOptions:{columns:":visible",format:{body:function(t,s,a){t.match(/<span class="pta-sortdate">/)&&(t=t.substring(45));var i=t.replace(/<br\s*\/?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," "),n=e("<div>"+i+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}}}},{extend:"pdf",text:PTASUS.pdfSave,title:n,message:c,orientation:"landscape",exportOptions:{columns:":visible",format:{body:function(t,s,a){t.match(/<span class="pta-sortdate">/)&&(t=t.substring(45));var i=t.replace(/<br\s*\/?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," "),n=e("<div>"+i+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}}}},{extend:"print",text:PTASUS.toPrint,title:n,message:r,exportOptions:{columns:":visible",format:{body:function(t,s,a){t.match(/<span class="pta-sortdate">/)&&(t=t.substring(45));var i=t.replace(/<br\s*\/?>/gi,"\n").replace("&nbsp;"," ").replace("&nbsp;"," "),n=e("<div>"+i+"</div>");return n.find("a").replaceWith(function(){return this.childNodes}),n.text()}}},customize:function(t){e(t.document.body).find("table").addClass("display").css("font-size","11px")}},{extend:"colvis",text:PTASUS.colvisText},{text:PTASUS.hideRemaining,action:function(e,t,s,a){h.rows(".remaining").remove().draw(!1),this.disable()}},"createState","savedStates"]};function d(t){t.draw(),e(".pta-select-filter").remove(),t.columns(".select-filter").every(function(){var t=this,s=e('<select class="pta-select-filter" />').appendTo(this.footer()).on("change",function(){var s=e.fn.dataTable.util.escapeRegex(e(this).val());t.search(s?"^"+s+"$":"",!0,!1).draw()});s.append(e('<option value="">'+PTASUS.showAll+"</option>")),this.cache("search").sort().unique().each(function(t){if(""!==t){let a=t;t.match(/\|/)&&(a=t.substring(11)),s.append(e('<option value="'+t+'">'+a+"</option>"))}})})}PTASUS.disableAdminGrouping||(l.rowGroup={dataSrc:[0,1],startRender:function(e,t,s){return t}},l.columnDefs=[{targets:[0,1],visible:!1}],l.buttons.push({text:PTASUS.disableGrouping,action:function(e,t,s,a){u.rowGroup().disable().draw(),this.disable()}}),p.rowGroup={dataSrc:[0,1,2],startRender:function(e,t,s){return t}},p.columnDefs=[{targets:[0,1,2],visible:!1}],p.buttons.push({text:PTASUS.disableGrouping,action:function(e,t,s,a){h.rowGroup().disable().draw(),this.disable()}}));var u=e("#pta-sheet-signups").DataTable(l);u.on("column-reorder",function(e,t,s){d(u)}),d(u);var h=e("#pta-all-data").DataTable(p);h.on("column-reorder",function(e,t,s){d(h)}),d(h),e('#pta-reschedule-sheet-form [name="method"]').on("change",function(t){"multi-copy"===e(this).val()?(e(".pta-hide-if-multi").hide(),e(".pta-show-if-multi").show(),e(".singlePicker").prop("required",!1),e(".pta-multi-input").prop("required",!0)):(e(".pta-hide-if-multi").show(),e(".pta-show-if-multi").hide(),e(".singlePicker").prop("required",!0),e(".pta-multi-input").prop("required",!1))}).trigger("change");let m=e("#pta_sheet_id"),f=e("p.task_select"),g=e("#pta_task_id"),v=e("p.move-signup"),b=e("#pta-move-signup-submit"),x=e("p.admin_confirm"),k=e("#pta_admin_confirm"),_=e("#signup_qty").val();function S(t){const s=e('<div class="notice notice-success" style="position: fixed; top: 32px; left: 50%; transform: translateX(-50%); z-index: 9999; min-width: 300px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);"><p>'+t+'<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></p></div>');e("body").append(s),s.find(".notice-dismiss").on("click",function(){s.fadeOut(()=>s.remove())}),setTimeout(()=>{s.fadeOut(()=>s.remove())},2e3)}g.on("change",function(){x.hide().prop("checked",!1);let t=e("#pta-ajax-messages");t.length&&t.remove(),""!==e(this).val()&&x.show().prop("checked",!1)}),m.on("change",function(){f.hide(),g.empty(),v.hide(),x.hide().prop("checked",!1);let t=e(this).val(),s={action:"pta_sus_get_tasks_for_sheet",security:PTASUS.ptaNonce,sheet_id:t,old_task_id:e("#old_task_id").val(),old_signup_id:e("#old_signup_id").val(),qty:_};e.post(ajaxurl,s,function(s){if(s&&(!1===s.success&&""!==t&&(e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>'+s.message+"</p></div>"),e(".pta-message-close").on("click",function(t){t.preventDefault(),e("#pta-message").fadeOut("fast",function(){e("#pta-message").remove()})})),!0===s.success)){let t=s.tasks;console.log(Object.keys(t).length),e(t).length?(Object.keys(t).length>1?g.append(e("<option></option>").attr("value","").text("Please Select a Task")):v.show(),Object.keys(t).length>0?(f.show(),e.each(t,function(t,s){g.append(e("<option></option>").attr("value",t).text(s))}),1===Object.keys(t).length&&g.trigger("change")):e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>No Available Tasks for that event.</p></div>')):e("#pta-ajax-messages").html('<div id="pta-message" class="pta-sus error"><span class="pta-message-close"><a href="">X</a></span><p>No Available Tasks for that event.</p></div>')}})}).trigger("change"),k.on("click change",function(){e(this).is(":checked")?(v.show(),b.prop("disabled",!1)):(v.hide(),b.prop("disabled",!0))}),e("#pta-sus-template-helper-toggle").on("click",function(){e("#pta-sus-template-helper-panel").toggleClass("active")}),e(".tag-item").on("click",function(){const t=e(this).data("tag");if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(t).then(()=>{S("Template tag copied to clipboard!")});else{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),S("Template tag copied to clipboard!")}}),e(".pta-sus-helper-search input").on("input",function(){const t=e(this).val().toLowerCase();e(".tag-item").each(function(){const s=e(this).text().toLowerCase();e(this).toggle(s.includes(t))})}),e(document).on("keyup",function(t){"Escape"===t.key&&e("#pta-sus-template-helper-panel").removeClass("active")}),e(".pta-sus-helper-search").append('<button type="button" class="pta-helper-close" aria-label="Close template helper"><span class="dashicons dashicons-no-alt"></span></button>'),e(".pta-helper-close").on("click",function(){e("#pta-sus-template-helper-panel").removeClass("active")})}(jQuery);