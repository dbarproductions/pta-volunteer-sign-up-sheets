# Phase 2: Email Template Consolidation
## PTA Volunteer Sign-Up Sheets Plugin

---

## Goal Description

Consolidate email template management into the main plugin, creating a unified system that:
- Allows **Signup Sheet Authors** to create and manage their own email templates
- Enables extensions (Customizer, Automated Emails) to use a shared template system
- Maintains backward compatibility with existing Customizer extension functionality
- Provides a foundation for future extension features (like Automated Emails' loop templates)
- Reduces code duplication across extensions

---

## Current State Analysis

### Main Plugin Email System
- **Storage:** Email templates stored in `pta_volunteer_sus_email_options` option array
- **Email Types:** confirmation, reminder, reminder2, clear, reschedule, signup_validation, user_validation
- **Processing:** `PTA_SUS_Email_Functions::send_mail()` retrieves templates from options
- **Filter Hooks:** `pta_sus_email_subject` and `pta_sus_email_template` allow extensions to override

### Customizer Extension
- **Storage:** Custom templates in `pta_volunteer_sus_customizer_custom_emails` option array
- **Sheet Assignments:** `pta_volunteer_sus_customizer_sheet_emails` maps sheet IDs to template slugs
- **Integration:** Hooks into `pta_sus_email_subject` and `pta_sus_email_template` filters
- **UI:** Adds email template dropdowns to sheet edit form
- **Email Types Supported:** confirmation, reminder, reminder2, reschedule, clear, validate

### Automated Emails Extension
- **Storage:** Custom database table `ptavae_emails`
- **Model Class:** `PTAVAE_Email` class with properties: admin_name, subject, body_plain, body_html, from_name, from_email, content_type
- **Advanced Features:** Loop templates for sheets/tasks/signups (`{sheets}`, `{tasks}`, `{signups}` placeholders)
- **Template Types:** sheets_template, tasks_template, signups_template (for loops)

---

## Proposed Implementation

### 1. Database Changes

#### 1.1 New Table: `pta_sus_email_templates`
**File:** `classes/class-pta_sus_activation.php`

```sql
CREATE TABLE {$wpdb->prefix}pta_sus_email_templates (
    id INT(11) NOT NULL AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL DEFAULT '',
    subject VARCHAR(255) NOT NULL DEFAULT '',
    body TEXT NOT NULL,
    from_name VARCHAR(255) NOT NULL DEFAULT '',
    from_email VARCHAR(100) NOT NULL DEFAULT '',
    content_type VARCHAR(20) NOT NULL DEFAULT 'plain',
    author_id INT(11) NOT NULL DEFAULT 0,
    is_system_default TINYINT(1) NOT NULL DEFAULT 0,
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL,
    PRIMARY KEY (id),
    KEY author_id (author_id),
    KEY is_system_default (is_system_default)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Column Definitions:**
- `id` - Primary key
- `title` - Admin-friendly name for the template
- `subject` - Email subject line (supports template tags)
- `body` - Email body content (supports template tags, HTML if content_type is 'html')
- `from_name` - Custom From name (optional, overrides default)
- `from_email` - Custom From email (optional, overrides default)
- `content_type` - 'plain' or 'html'
- `author_id` - WordPress user ID of template creator (0 = Global template available to all)
- `is_system_default` - 1 = System default template (created during migration), 0 = User-created template
- `created_at` - Timestamp when template was created
- `updated_at` - Timestamp when template was last updated

**Note:** Templates are **generic** and can be assigned to any email type. The assignment happens at the sheet/task level via template ID columns.

#### 1.2 Update `pta_sus_sheets` Table
**File:** `classes/class-pta_sus_activation.php`

Add columns for email template IDs:
- `confirmation_email_template_id` INT(11) NOT NULL DEFAULT 0
- `reminder1_email_template_id` INT(11) NOT NULL DEFAULT 0
- `reminder2_email_template_id` INT(11) NOT NULL DEFAULT 0
- `clear_email_template_id` INT(11) NOT NULL DEFAULT 0
- `reschedule_email_template_id` INT(11) NOT NULL DEFAULT 0
- `signup_validation_email_template_id` INT(11) NOT NULL DEFAULT 0

**Note:** Default value of 0 means "Use System Default"

#### 1.3 Update `pta_sus_tasks` Table (Phase 2B - After Sheet-Level Working)
**File:** `classes/class-pta_sus_activation.php`

Add same columns as sheets (for task-specific templates):
- Default value of 0 means "Use Sheet Template"
- If sheet template is also 0, then use System Default
- Follows same pattern as Custom Fields extension's signup templates

**Implementation:** Defer to Phase 2B after sheet-level templates are working and tested.

---

### 2. New Model Class

#### 2.1 Create `PTA_SUS_Email_Template` Class
**File:** `classes/models/class-pta-sus-email-template.php`

**Base:** Extend `PTA_SUS_Base_Object` (like Sheet, Task, Signup classes)

**Properties:**
```php
protected function get_property_definitions() {
    return array(
        'title' => 'text',
        'subject' => 'text',
        'body' => 'textarea', // Single body field - can be plain text or HTML based on content_type
        'from_name' => 'text',
        'from_email' => 'email',
        'content_type' => 'text', // 'plain' or 'html'
        'author_id' => 'int',
        'is_system_default' => 'bool',
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
    );
}
```

**Note:** No `email_type` property - templates are generic and can be assigned to any email type.

**Methods:**
- `get_title()` - Get template title
- `get_subject()` - Get subject line
- `get_body()` - Get body content
- `get_from_name($default = '')` - Get From name (with fallback)
- `get_from_email($default = '')` - Get From email (with fallback)
- `get_content_type()` - Get content type ('plain' or 'html')
- `format_plain_text($text)` - Convert HTML to plain text (for plain content type)
- `replace_placeholders($signup, $task, $sheet)` - Replace template tags (delegate to PTA_SUS_Template_Tags)

**Editor Selection:**
- Check main plugin setting: `pta_volunteer_sus_email_options['use_html']`
- If HTML enabled: Use `wp_editor()` for body field (TinyMCE)
- If HTML disabled: Use textarea for body field
- Single `body` field stores either plain text or HTML based on `content_type` property

---

### 3. Helper Class Updates

#### 3.1 Update `PTA_SUS_Email_Functions`
**File:** `classes/class-pta_sus_email_functions.php`

**New Methods:**
```php
/**
 * Get active email template for a specific email type
 * Checks: Task template -> Sheet template -> System default
 * 
 * @param string $email_type Email type (confirmation, reminder, reminder2, clear, reschedule, signup_validation)
 * @param int $sheet_id Sheet ID
 * @param int $task_id Task ID (optional, for task-specific templates in Phase 2B)
 * @return PTA_SUS_Email_Template|false Template object or false if not found
 */
public static function get_active_email_template($email_type, $sheet_id, $task_id = 0)

/**
 * Get system default template ID for an email type
 * Stored in options: pta_volunteer_sus_email_template_defaults
 * 
 * @param string $email_type Email type
 * @return int Template ID, or 0 if not set
 */
public static function get_system_default_template_id($email_type)

/**
 * Get system default template object for an email type
 * Handles fallback: if reminder2 not set, use reminder1
 * 
 * @param string $email_type Email type
 * @return PTA_SUS_Email_Template|false Template object or false if not found
 */
public static function get_system_default_template($email_type)

/**
 * Get templates available to current user
 * Authors see their own + templates with author_id = 0 (available to all)
 * Admins/Managers see all templates
 * 
 * @param bool $include_system_defaults Whether to include system defaults
 * @return array Array of PTA_SUS_Email_Template objects
 */
public static function get_available_templates($include_system_defaults = true)

/**
 * Set system default template for an email type
 * Updates options: pta_volunteer_sus_email_template_defaults
 * 
 * @param string $email_type Email type
 * @param int $template_id Template ID (0 to unset)
 * @return bool Success
 */
public static function set_system_default_template($email_type, $template_id)
```

**Modify `send_mail()` Method:**
- Replace direct option retrieval with `get_active_email_template()`
- Template resolution hierarchy:
  1. Check task template (if task_id provided and task-level templates enabled in Phase 2B)
  2. Check sheet template (if template_id > 0 for this email type)
  3. Use system default template (from options, with reminder2 fallback to reminder1)
  4. Fall back to options (backward compatibility during migration)
- Use template object's methods to get subject/body
- **Reminder2 Fallback Logic:** If reminder2 template not set (ID = 0), use reminder1 template
- Maintain backward compatibility: if no template found, fall back to options (for migration period)

**Template Tag Replacement:**
- Continue using existing `PTA_SUS_Template_Tags` class
- Template objects can call `replace_placeholders()` which uses `PTA_SUS_Template_Tags`

---

### 4. Admin Interface Updates

#### 4.1 Add "Email Templates" Submenu
**File:** `classes/class-pta_sus_admin.php`

**Menu Registration:**
- Add submenu under "Sign-up Sheets" menu
- Capability: `manage_signup_sheets` (Authors can access)
- Page slug: `pta-sus-email-templates`

**Page Handler:**
- `admin_email_templates_page()` method
- List table showing templates (filtered by author if not admin/manager)
- Actions: Add, Edit, Delete, Duplicate
- Filter by email type
- Search by title

#### 4.2 Email Templates List Table
**File:** `classes/email-templates-list-table.php` (new file)

**Columns:**
- Title
- Email Type
- Author (Name/Email, or "System Default")
- Content Type (Plain/HTML)
- Created Date
- Actions (Edit, Delete, Duplicate)

**Filtering:**
- Authors see only their templates + system defaults
- Admins/Managers see all templates
- Filter by email type dropdown

#### 4.3 Add/Edit Template Form
**File:** `views/admin-email-template-form.php` (new file)

**Fields:**
- Title (required)
- Subject (required, supports template tags)
- Body (required):
  - If HTML emails enabled in main plugin settings: Use `wp_editor()` (TinyMCE)
  - If HTML emails disabled: Use textarea
  - Template Tag Helper button/link
- Content Type (Plain Text / HTML radio buttons) - affects how body is stored/displayed
- From Name (optional)
- From Email (optional)
- Author Assignment (for Admins/Managers only):
  - Dropdown of WordPress users with `manage_signup_sheets` capability
  - Option for "Available to All" (author_id = 0)
  - Read-only/disabled for Authors (shows current author name)

**Permissions:**
- Authors can only edit their own templates
- System default templates (is_system_default = 1) are read-only for Authors
- Admins/Managers can edit any template
- Admins/Managers can reassign author (except system defaults cannot be reassigned)

#### 4.4 Update Sheet Edit Form
**File:** `views/admin-sheet-form-html.php` or `classes/class-pta_sus_admin.php`

**Add Email Template Selection Section:**
- Dropdown for each email type (confirmation, reminder1, reminder2, clear, reschedule, signup_validation)
- Options: "Use System Default" (0), or list of available templates
- Filter templates by:
  - Current user's templates (if Author)
  - Templates with author_id = 0 (available to all)
  - All templates (if Admin/Manager)
- Templates are generic - same template can be assigned to multiple email types

**Integration with Customizer:**
- Customizer extension currently adds its own email template dropdowns
- Need to coordinate: either replace Customizer's UI, or merge both systems
- **Decision Point:** Should we deprecate Customizer's email system, or keep both working in parallel?

#### 4.5 Update Task Edit Form (Phase 2B - After Sheet-Level Working)
**File:** `views/admin-task-form-html.php`

**Add Email Template Selection:**
- Add dropdown for each email type in each task row
- Options: "Use Sheet Template" (0/empty), or list of available templates
- Follows same pattern as Custom Fields extension's signup template dropdowns
- Template hierarchy: Task template -> Sheet template -> System default
- Only show if task-level templates are enabled (Phase 2B)

---

### 5. Database Migration

#### 5.1 Migration Function
**File:** `classes/class-pta_sus_activation.php`

**Method:** `upgrade_to_6_2_0()` (or appropriate version)

**Steps:**
1. Create `pta_sus_email_templates` table if it doesn't exist (no `email_type` column - templates are generic)
2. Add email template ID columns to `pta_sus_sheets` table if they don't exist
3. Create new option: `pta_volunteer_sus_email_template_defaults` to store system default template IDs
   - Structure: array('confirmation' => template_id, 'reminder1' => template_id, 'reminder2' => template_id, 'clear' => template_id, 'reschedule' => template_id, 'signup_validation' => template_id)
   - If reminder2 not set (empty/0), system will fall back to reminder1 in `get_system_default_template()`
4. Migrate existing email templates from options to database:
   - Read `pta_volunteer_sus_email_options`
   - Create `PTA_SUS_Email_Template` records for each email type:
     - confirmation_email_subject/template → create template, store ID in defaults array
     - reminder_email_subject/template → create template, store ID in defaults array
     - reminder2_email_subject/template → if not empty, create template and store ID; if empty, leave as 0 (will use reminder1 fallback)
     - clear_email_subject/template → create template, store ID in defaults array
     - reschedule_email_subject/template → create template, store ID in defaults array
   - Read `pta_volunteer_sus_validation_options`
   - Create templates for:
     - signup_validation_email_subject/template → create template, store ID in defaults array
     - user_validation_email_subject/template → create template, store ID in defaults array (if used)
   - Set `author_id = 0` and `is_system_default = 1` for all migrated templates
   - Set `created_at` and `updated_at` to current timestamp
   - Save template IDs to `pta_volunteer_sus_email_template_defaults` option
   - **IMPORTANT:** System defaults cannot be reassigned to authors (protected in UI)
5. Migrate Customizer extension templates (if Customizer is active):
   - Check if Customizer extension exists (`class_exists('PTA_SUS_CUSTOMIZER_INTEGRATOR')`)
   - Check Customizer version: `defined('PTA_VOL_SUS_CUSTOMIZER_VERSION') ? PTA_VOL_SUS_CUSTOMIZER_VERSION : '0.0.0'`
   - Read `pta_volunteer_sus_customizer_custom_emails`
   - For each custom email:
     - Create template record (generic, no email_type - templates can be assigned to any email type)
     - Set `author_id = 0` (available to all users)
     - Set `is_system_default = 0` (user-created, migrated template)
   - Migrate sheet assignments from `pta_volunteer_sus_customizer_sheet_emails`:
     - Map old slug-based assignments to new template ID assignments
     - Update `pta_sus_sheets` table with template IDs for appropriate email types
6. **Backward Compatibility with Old Customizer:**
   - Check Customizer version: if `version_compare(PTA_VOL_SUS_CUSTOMIZER_VERSION, '4.1.0', '<')` (or appropriate version threshold)
   - If old Customizer detected:
     - Remove Customizer's email template filter hooks (`pta_sus_email_subject`, `pta_sus_email_template`)
     - Add site-wide dismissible admin notice informing users that email templates are now in main plugin
     - Notice stored in option: `pta_sus_email_template_notice_dismissed` (site-wide, not per-user)
     - Load compatibility code only if old Customizer version detected
7. Update database version to new version

**Backward Compatibility:**
- Keep reading from options as fallback if template not found
- Add admin notice if migration completed successfully
- Allow manual re-run of migration if needed (for testing)

---

### 6. Extension Integration

#### 6.1 Customizer Extension Updates
**File:** `pta-volunteer-sus-customizer/includes/class-pta-sus-customizer-integrator.php`

**Phase 2A: Backward Compatibility (Main Plugin)**
- During migration, convert Customizer templates to new system
- If old Customizer version detected:
  - Disable Customizer's email template filter hooks in main plugin
  - Add dismissible admin notice about templates moving to main plugin
  - Load compatibility code only if old Customizer version detected
- New main plugin works with old Customizer (templates migrated, hooks disabled)

**Phase 2B: Customizer Update (Extension)**
- Update Customizer extension (V6-Prep branch) to:
  - Check if main plugin version >= 6.0.0 (or template class exists)
  - Remove email template management UI
  - Remove email template filter hooks
  - Use main plugin's template system
  - Show admin notice if main plugin is outdated
- After Customizer update released, old version compatibility code can be removed in future main plugin version

#### 6.2 Automated Emails Extension Integration (Future)
**File:** `pta-volunteer-sus-automated-emails/includes/class-ptavae-email.php`

**Considerations:**
- Automated Emails has advanced features (loop templates)
- May need to extend base template class or create specialized class
- Can share common functionality (from_name, from_email, content_type)
- Loop templates (`{sheets}`, `{tasks}`, `{signups}`) are unique to Automated Emails

**Approach:**
- Create base `PTA_SUS_Email_Template` class in main plugin
- Automated Emails can extend it or use composition
- Share template tag replacement logic
- Keep loop functionality in Automated Emails extension

---

### 7. Security & Permissions

#### 7.1 Template Access Control
- **System Defaults (`author_id = 0`, `is_system_default = 1`):**
  - Visible to all users
  - Read-only for Authors (cannot edit/delete)
  - Editable by Admins/Managers
  - **Cannot be reassigned to an author** (always remain system defaults)
  - **Must have at least one system default per email type**

- **Migrated Templates (`author_id = 0`, `is_system_default = 0`):**
  - Templates migrated from Customizer extension
  - Visible to all users (available to all Authors)
  - Editable by Admins/Managers
  - **Can be reassigned to an author** by Admins/Managers when editing template

- **User Templates (`author_id > 0`):**
  - Visible to creator + Admins/Managers
  - Authors can only edit/delete their own templates
  - Admins/Managers can edit/delete any user template
  - **Can be reassigned to different author** by Admins/Managers

- **Template Assignment:**
  - Authors can only assign their own templates + system defaults + migrated templates (author_id = 0) to sheets
  - Admins/Managers can assign any template to any sheet

#### 7.2 Capability Checks
- `manage_signup_sheets` - Can create/edit/delete own templates
- `manage_others_signup_sheets` - Can create/edit/delete any template, edit system defaults

---

### 8. Template Tag System

#### 8.1 Existing System
**File:** `classes/class-pta_sus_template_tags.php`

- Already handles template tag replacement
- Supports signup, task, and sheet tags
- Extensible via filters

#### 8.2 Integration
- `PTA_SUS_Email_Template` class will use existing `PTA_SUS_Template_Tags` class
- No changes needed to template tag system
- Extensions can continue to add custom tags via filters

---

## Implementation Phases

### Phase 2A: Core Template System (This Phase)
1. Create database table and model class
2. Create `PTA_SUS_Email_Template` model class
3. Add helper methods to `PTA_SUS_Email_Functions`
4. Create admin UI for template management
5. Add template selection to sheet edit form
6. Update `send_mail()` to use templates (sheet-level only)
7. Database migration from options to templates
8. Migrate Customizer templates if extension exists
9. Add backward compatibility code for old Customizer version
10. Add dismissible admin notice about templates (if old Customizer detected)
11. Maintain backward compatibility with options

### Phase 2B: Customizer Integration (Future)
1. Update Customizer to use main plugin's template system
2. Migrate Customizer templates
3. Remove duplicate email management code from Customizer
4. Update Customizer's sheet assignment logic

### Phase 2C: Task-Level Templates (Future - Optional)
1. Add template ID columns to `pta_sus_tasks` table
2. Update task edit form with template dropdowns
3. Update `get_active_email_template()` to check task templates
4. Add "Use Sheet Default" option

### Phase 2D: Automated Emails Integration (Future)
1. Create extended template class or adapter for Automated Emails
2. Share common functionality (from_name, from_email, etc.)
3. Keep loop template functionality in Automated Emails
4. Integrate template tag replacement

---

## Verification Plan

### Database Verification
- [ ] `pta_sus_email_templates` table created with correct structure
- [ ] Email template ID columns added to `pta_sus_sheets` table
- [ ] Indexes created on `author_id`, `email_type`, `is_system_default`
- [ ] Migration successfully creates system default templates
- [ ] Migration preserves Customizer templates (if active)

### Template Management
- [ ] Authors can create/edit/delete their own templates
- [ ] Authors can see system defaults but cannot edit them
- [ ] Authors can only assign their own templates + system defaults
- [ ] Admins/Managers can create/edit/delete any template
- [ ] Admins/Managers can edit system defaults
- [ ] Template list table filters correctly by author

### Sheet Integration
- [ ] Sheet edit form shows email template dropdowns
- [ ] Templates are filtered by user permissions
- [ ] Template assignments save correctly
- [ ] "Use System Default" option works (value = 0)

### Email Sending
- [ ] Emails use assigned template if set
- [ ] Emails fall back to system default if no template assigned
- [ ] Template tags are replaced correctly
- [ ] HTML emails render correctly
- [ ] Plain text emails format correctly
- [ ] Custom From name/email work when set in template

### Backward Compatibility
- [ ] Existing options still work as fallback
- [ ] Customizer extension continues to work (if not updated)
- [ ] No breaking changes to existing functionality

### Migration Testing
- [ ] Migration runs successfully on fresh install
- [ ] Migration runs successfully on existing install with templates in options
- [ ] Migration handles Customizer templates if extension is active
- [ ] Migration is idempotent (can run multiple times safely)
- [ ] Rollback plan if migration fails

---

## Decisions Made

1. **Task-Level Templates:** Defer to Phase 2B. Focus on sheet-level templates first, then add task-level following Custom Fields signup template pattern.

2. **Template Hierarchy:** Task template (if set) -> Sheet template (if set) -> System default. Value of 0 means "use next level up".

3. **Customizer Integration:** 
   - Phase 2A: Migrate templates, disable old hooks, maintain backward compatibility
   - Phase 2B: Update Customizer extension to use new system
   - Add dismissible admin notice about templates moving to main plugin

4. **Template Body Storage:** Single `body` field with `content_type`. Simpler, and we can convert HTML to plain text when needed.

5. **System Default Protection:** 
   - Editable by Admins/Managers, but clearly marked as "System Default" with warning
   - Cannot be reassigned to an author (always remain system defaults)
   - Must maintain at least one system default per email type

6. **Migrated Customizer Templates:** 
   - Set `author_id = 0` and `is_system_default = 0` (available to all, but not system defaults)
   - Admins can reassign these to specific authors when editing

7. **Template Duplication:** Yes, add "Duplicate" action that creates a copy with `author_id = current_user_id` and `is_system_default = 0`.

8. **Template Genericity:** Templates are generic (no email_type field) and can be assigned to any email type. Assignment happens at sheet/task level via template ID columns. Same template can be used for multiple email types.

9. **System Default Storage:** System default template IDs stored in `pta_volunteer_sus_email_template_defaults` option array, not in template records themselves. This allows templates to be generic while maintaining default assignments per email type.

10. **Reminder2 Fallback:** If reminder2 system default template ID is 0 or not set, `get_system_default_template('reminder2')` will return the reminder1 template. This matches current behavior where empty reminder2 options fall back to reminder1.

11. **Author Assignment UI:** Dropdown for Admins/Managers (consistent with sheet author field), read-only/disabled for Authors showing current author name.

12. **Template Editor:** Use `wp_editor()` if `pta_volunteer_sus_email_options['use_html']` is true, otherwise use textarea. Single `body` field stores content based on `content_type` property.

13. **Version Detection:** Use `PTA_VOL_SUS_CUSTOMIZER_VERSION` constant to detect old Customizer versions for backward compatibility.

14. **Admin Notice:** Site-wide dismissible notice (stored in option, not user meta) for old Customizer compatibility.

9. **Release Strategy:** Main plugin (6.0.0) released first, extensions updated 1-2 weeks later. Maintain backward compatibility during transition.

10. **Template Genericity:** Templates are generic (no `email_type` field) and can be assigned to any email type. Assignment happens at sheet/task level via template ID columns. Same template can be used for multiple email types.

11. **System Default Storage:** System default template IDs stored in `pta_volunteer_sus_email_template_defaults` option array, not in template records themselves. This allows templates to be generic while maintaining default assignments per email type.

12. **Reminder2 Fallback:** If reminder2 system default template ID is 0 or not set, `get_system_default_template('reminder2')` will return the reminder1 template. This matches current behavior where empty reminder2 options fall back to reminder1.

13. **Author Assignment UI:** Dropdown for Admins/Managers (consistent with sheet author field), read-only/disabled for Authors showing current author name.

14. **Template Editor:** Use `wp_editor()` if `pta_volunteer_sus_email_options['use_html']` is true, otherwise use textarea. Single `body` field stores content based on `content_type` property.

15. **Version Detection:** Use `PTA_VOL_SUS_CUSTOMIZER_VERSION` constant to detect old Customizer versions for backward compatibility.

16. **Admin Notice:** Site-wide dismissible notice (stored in option `pta_sus_email_template_notice_dismissed`, not user meta) for old Customizer compatibility.

---

## Notes

- This consolidation will reduce code duplication across extensions
- Provides foundation for future features (task-level templates, template versioning, etc.)
- Maintains backward compatibility during transition period
- Authors gain ability to customize emails for their sheets
- System remains flexible for extension developers

---

**Last Updated:** [Date]
**Status:** Ready for Implementation Discussion
